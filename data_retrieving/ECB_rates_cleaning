"""
Import des modules
pip install -q lxml
pip install webdriver-manager
"""
#Import des librairies
import bs4
import lxml
import pandas
import urllib
import subprocess
import pandas as pd
from urllib import request


#Installation des modules 
modules = ["-q lxml", "webdriver-manager"]
for module in modules:
    subprocess.run(["pip", "install", module])


url_ecb = "https://www.ecb.europa.eu/stats/policy_and_exchange_rates/key_ecb_interest_rates/html/index.en.html"

request_text = request.urlopen(url_ecb).read()
page = bs4.BeautifulSoup(request_text, "lxml")

print(page.find("table"))
policy_rates_df = page.find('table')
print(policy_rates_df)

table_body = policy_rates_df.find('tbody')
rows = table_body.find_all('tr')
print(rows[0])

data = []

for row in rows:
    cols = row.find_all('td')
    cols = [ele.text.strip() for ele in cols]
    if cols[0] == '':
        cols[0] = previous_value
    previous_value = cols[0]
    data.append(cols)

print(data[0])
columns = ['Year', 'Date', 'Deposit facility', 'Fixed rate', 'Minimum bid rate', 'Marginal lending facility']
df = pd.DataFrame(data, columns=columns)
print(df.head())